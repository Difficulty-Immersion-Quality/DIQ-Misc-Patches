// ==================================== Increasing compatibility through proper self inheritence entries  ====================================

// ==================================== Slashing Flourish (Ranged) - Fix to target selection allowing the same target to be picked twice (Credit to Rydiak - Item and Spell Bug Fixes - Mod.io) ====================================

new entry "Projectile_BladeFlourish_Slashing"
type "SpellData"
data "SpellType" "Projectile"
// using "Projectile_MainHandAttack"
using "Projectile_BladeFlourish_Slashing"
// data "SpellFlags" "HasHighGroundRangeExtension;RangeIgnoreVerticalThreshold;IsHarmful"
data "SpellFlags" "HasHighGroundRangeExtension;RangeIgnoreVerticalThreshold;IsHarmful;IgnorePreviouslyPickedEntities"




// Vanilla
new entry "CollegeOfLore_Proficiency"
type "PassiveData"
using "CollegeOfLore_Proficiency"
// Gain Proficiency in Arcana, Intimidation and Sleight of Hand.
// data "Description" "hf232d3e3g0926g4d8bga86cg3a680ff04884;3"
// Gain &lt;LSTag Tooltip="Proficiency"&gt;Proficiency&lt;/LSTag&gt; in 3 skills of your choosing.
data "Description" "h2d1139fcg83adg418cga914g3623f97eeb3d;3"

new entry "Projectile_BladeFlourish_Defensive"
type "SpellData"
data "SpellType" "Projectile"
// using "Projectile_MainHandAttack"
using "Projectile_BladeFlourish_Defensive"
// data "SpellFail" "IF(HasStatus('YSRSLIDFWWADNIWHWIHLY')):SpawnExtraProjectiles(Projectile_BladeFlourish_Defensive);ApplyStatus(YSRSLIDFWWADNIWHWIHLY_YWNK,100,1)"
data "SpellFail" ""





new entry "Blade_Flourish_Movement_Speed"
type "PassiveData"
data "Icon" "Action_SlashingFlourish_Melee"
data "Properties" "Highlighted"
data "DisplayName" "hdf01a14eg5040g4caeg9c66g53ca380dd54f;1"
data "Description" "h051ffef6gc18fg49ebga204g0268a7d710e0;1"
data "StatsFunctorContext" "OnAttack"
data "Conditions" "IsWeaponAttack() and IsMainHandAttack()"
data "StatsFunctors" "ApplyStatus(SELF,Blade_Flourish_Movement_Speed_Boost,100,1)"

new entry "Projectile_BladeFlourish_Slashing"
type "SpellData"
data "SpellType" "Projectile"
using "Projectile_BladeFlourish_Slashing"
data "SpellFail" ""

new entry "Zone_BladeFlourish_Slashing"
type "SpellData"
data "SpellType" "Target"
using "Zone_BladeFlourish_Slashing"
data "SpellSuccess" "DealDamage(max(1,MainMeleeWeapon + LevelMapValue(BardicInspiration)), MainMeleeWeaponDamageType); ExecuteWeaponFunctors(MainHand)"
data "TooltipDamageList" "DealDamage(MainMeleeWeapon + LevelMapValue(BardicInspiration), MainMeleeWeaponDamageType)"
data "MaximumTargets" ""

new entry "Target_BladeFlourish_Mobile"
type "SpellData"
data "SpellType" "Target"
using "Target_BladeFlourish_Mobile"
data "PrepareSound" "Action_Prepare_Bard_Flourish"
data "PrepareLoopSound" "Action_Loop_Bard_Flourish"

new entry "BLADE_FLOURISH_MOBILE_TARGET"
type "StatusData"
data "StatusType" "BOOST"
using "BLADE_FLOURISH_MOBILE_TARGET"
data "StatusPropertyFlags" "ApplyToDead"

new entry "Blade_Flourish_Movement_Speed_Boost"
type "StatusData"
data "StatusType" "BOOST"
data "StackId" "Blade_Flourish_Movement_Speed_Boost"
data "TickType" "EndTurn"
data "Boosts" "ActionResource(Movement,3,0)"
data "StatusGroups" "SG_RemoveOnRespec"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"

new entry "Interrupt_BardicInspiration_Attack"
type "InterruptData"
using "Interrupt_BardicInspiration_Attack"
data "Properties" "AdjustRoll(OBSERVER_OBSERVER,ResourceRoll(BardicInspiration,1));RemoveStatus(OBSERVER_OBSERVER,BARDIC_INSPIRATION);RemoveStatus(OBSERVER_OBSERVER,BARDIC_INSPIRATION_D8);RemoveStatus(OBSERVER_OBSERVER,BARDIC_INSPIRATION_D10);ApplyStatus(OBSERVER_OBSERVER,INTERRUPT_BARDIC_INSPIRATION_ATTACK,100,0)"
data "EnableCondition" "not HasStatus('SG_Polymorph') or Tagged('MINDFLAYER')"
data "EnableContext" "OnStatusApplied"

new entry "Interrupt_CombatInspiration_SavingThrow_ArmorClass"
type "InterruptData"
using "Interrupt_CombatInspiration_Attack"
data "DisplayName" "h7ab5fb1fg7bc8g4403gbe63g19b28d7b2bd3;1"
data "Description" "h7f53adbag7148g45c1g9915g1480491df7b8;3"
data "Icon" "PassiveFeature_CombatInspiration_ArmorClassOrSavingThrow"
data "InterruptContext" "OnPostRoll"
data "Conditions" "not Dead(context.Observer) and ((HasInterruptedAttack() and IsFlatValueInterruptInteresting(6, context.Source)) or (HasInterruptedSavingThrow() and IsFlatValueInterruptInteresting(6))) and Self(context.Observer,context.Target) and not AnyEntityIsItem()"
data "Properties" "IF(HasInterruptedSavingThrow()):AdjustRoll(OBSERVER_OBSERVER,ResourceRoll(BardicInspiration,1));IF(HasInterruptedAttack()):AdjustRoll(OBSERVER_OBSERVER,0-ResourceRoll(BardicInspiration,1));RemoveStatus(OBSERVER_OBSERVER,BARDIC_INSPIRATION_COMBAT);RemoveStatus(OBSERVER_OBSERVER,BARDIC_INSPIRATION_COMBAT_D8);RemoveStatus(OBSERVER_OBSERVER,BARDIC_INSPIRATION_COMBAT_D10);ApplyStatus(OBSERVER_OBSERVER,INTERRUPT_BARDIC_INSPIRATION_COMBAT_DEFENSE,100,0)"

new entry "Interrupt_CombatInspiration_Damage"
type "InterruptData"
using "Interrupt_CombatInspiration_Attack"
data "DisplayName" "haa3da5c0g3bc8g4fe1g870fgd137c96c4103;1"
data "Description" "h752b6036g1720g448eg85f1gd4c45a1d671b;2"
data "Icon" "PassiveFeature_CombatInspiration_WeaponDamage"
data "InterruptContext" "OnCastHit"
data "Conditions" "not Dead(context.Observer) and Character() and IsWeaponAttack() and Self(context.Source,context.Observer) and HasDamageEffectFlag(DamageFlags.Hit) and not IsKillingBlow() and not AnyEntityIsItem()"
data "Properties" "IF(IsMeleeAttack()):DealDamage(ResourceRoll(BardicInspiration,1), MainMeleeWeaponDamageType);IF(IsRangedAttack()):DealDamage(ResourceRoll(BardicInspiration,1), MainRangedWeaponDamageType);RemoveStatus(OBSERVER_OBSERVER,BARDIC_INSPIRATION_COMBAT);RemoveStatus(OBSERVER_OBSERVER,BARDIC_INSPIRATION_COMBAT_D8);RemoveStatus(OBSERVER_OBSERVER,BARDIC_INSPIRATION_COMBAT_D10);ApplyStatus(OBSERVER_OBSERVER,INTERRUPT_BARDIC_INSPIRATION_COMBAT_DAMAGE,100,0)"

new entry "Flourish_Interrupt_Unlock"
type "PassiveData"
data "Properties" "IsHidden"
data "Boosts" "UnlockInterrupt(Interrupt_Flourish_Defensive);UnlockInterrupt(Interrupt_Flourish_Mobile);UnlockInterrupt(Interrupt_Flourish_Slashing)"

new entry "Interrupt_Flourish_Defensive"
type "InterruptData"
data "DisplayName" "hbc91127bg5806g4cc4ga887gcab0b0a9722d;1"
data "Description" "ha808412bg1997g4f9agac3egaa6cc9509698;1"
data "Icon" "Action_DefensiveFlourish_Melee"
data "InterruptContext" "OnCastHit"
data "InterruptContextScope" "Self"
data "Container" "YesNoDecision"
data "Conditions" "Self(context.Source,context.Observer) and HasDamageEffectFlag(DamageFlags.Hit) and IsMainHandAttack() and not IsKillingBlow() and not AnyEntityIsItem() and not (SpellId('Projectile_BladeFlourish_Defensive') or SpellId('Projectile_BladeFlourish_Slashing') or SpellId('Projectile_BladeFlourish_Mobile') or SpellId('Zone_BladeFlourish_Slashing') or SpellId('Target_BladeFlourish_Defensive') or SpellId('Target_BladeFlourish_Mobile') or SpellId('Target_BladeFlourish_Slashing_ExtraAttack_Melee') or SpellId('Target_BladeFlourish_Slashing_ExtraAttack_Ranged'))"
data "Properties" "IF(IsMeleeAttack()):DealDamage(LevelMapValue(BardicInspiration), MainMeleeWeaponDamageType);IF(IsRangedAttack()):DealDamage(LevelMapValue(BardicInspiration), MainRangedWeaponDamageType); ApplyStatus(SELF,BLADE_FLOURISH_DEFENSIVE,100,1)"
data "Cost" "BardicInspiration:1"
data "EnableCondition" "HasActionResource('BardicInspiration',1,0,false,false,context.Source) and (not HasStatus('SG_Polymorph') or Tagged('MINDFLAYER'))"
data "EnableContext" "OnActionResourcesChanged"

new entry "Interrupt_Flourish_Mobile"
type "InterruptData"
data "DisplayName" "h1868715bga5bag4e54gad96g30bcdaf887bf;1"
data "Description" "h4cee93a9gc7d4g4cdcgb005g05e052efb9eb;1"
data "Icon" "Action_MobileFlourish_Melee"
data "InterruptContext" "OnCastHit"
data "InterruptContextScope" "Self"
data "Container" "YesNoDecision"
data "Conditions" "Self(context.Source,context.Observer) and HasDamageEffectFlag(DamageFlags.Hit) and IsMainHandAttack() and not IsKillingBlow() and not AnyEntityIsItem() and not (SpellId('Projectile_BladeFlourish_Defensive') or SpellId('Projectile_BladeFlourish_Slashing') or SpellId('Projectile_BladeFlourish_Mobile') or SpellId('Zone_BladeFlourish_Slashing') or SpellId('Target_BladeFlourish_Defensive') or SpellId('Target_BladeFlourish_Mobile') or SpellId('Target_BladeFlourish_Slashing_ExtraAttack_Melee') or SpellId('Target_BladeFlourish_Slashing_ExtraAttack_Ranged'))"
data "Properties" "IF(IsMeleeAttack()):DealDamage(LevelMapValue(BardicInspiration), MainMeleeWeaponDamageType);IF(IsRangedAttack()):DealDamage(LevelMapValue(BardicInspiration), MainRangedWeaponDamageType); ApplyStatus(BLADE_FLOURISH_MOBILE_TARGET,100,1); ApplyStatus(FLOURISH_MOBILE_PUSH,100,1); ApplyStatus(SELF,BLADE_FLOURISH_MOBILE,100,1)"
data "Cost" "BardicInspiration:1"
data "EnableCondition" "HasActionResource('BardicInspiration',1,0,false,false,context.Source) and (not HasStatus('SG_Polymorph') or Tagged('MINDFLAYER'))"
data "EnableContext" "OnActionResourcesChanged"

new entry "Interrupt_Flourish_Slashing"
type "InterruptData"
data "DisplayName" "h0f03b178ge532g4f77g9e6eg0901054cf3c7;1"
data "Description" "h72f89a91g821eg43fega0a2g02447dfe97cb;1"
data "Icon" "Action_SlashingFlourish_Melee"
data "InterruptContext" "OnCastHit"
data "InterruptContextScope" "Self"
data "Container" "YesNoDecision"
data "Conditions" "Self(context.Source,context.Observer) and HasDamageEffectFlag(DamageFlags.Hit) and IsMainHandAttack() and not IsKillingBlow() and not AnyEntityIsItem() and not (SpellId('Projectile_BladeFlourish_Defensive') or SpellId('Projectile_BladeFlourish_Slashing') or SpellId('Projectile_BladeFlourish_Mobile') or SpellId('Zone_BladeFlourish_Slashing') or SpellId('Target_BladeFlourish_Defensive') or SpellId('Target_BladeFlourish_Mobile') or SpellId('Target_BladeFlourish_Slashing_ExtraAttack_Melee') or SpellId('Target_BladeFlourish_Slashing_ExtraAttack_Ranged'))"
data "Properties" "IF(IsMeleeAttack()):DealDamage(LevelMapValue(BardicInspiration), MainMeleeWeaponDamageType);IF(IsRangedAttack()):DealDamage(LevelMapValue(BardicInspiration), MainRangedWeaponDamageType); ApplyStatus(FLOURISH_SLASHING_TARGET,100,1); IF(IsMeleeAttack()):ApplyStatus(SELF,FLOURISH_SLASHING_EXTRA_ATTACK_MELEE,100,1); IF(IsRangedAttack()):ApplyStatus(SELF,FLOURISH_SLASHING_EXTRA_ATTACK_RANGED,100,1)"
data "Cost" "BardicInspiration:1"
data "EnableCondition" "HasActionResource('BardicInspiration',1,0,false,false,context.Source) and (not HasStatus('SG_Polymorph') or Tagged('MINDFLAYER'))"
data "EnableContext" "OnActionResourcesChanged"

new entry "Target_BladeFlourish_Slashing_ExtraAttack_Melee"
type "SpellData"
data "SpellType" "Target"
using "Target_MainHandAttack"
data "SpellProperties" "GROUND:DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType);GROUND:ExecuteWeaponFunctors(MainHand);RemoveStatus(SELF,FLOURISH_SLASHING_EXTRA_ATTACK_MELEE)"
data "SpellRoll" "Attack(AttackType.MeleeWeaponAttack)"
data "SpellSuccess" "DealDamage(max(1,MainMeleeWeapon + LevelMapValue(BardicInspiration)), MainMeleeWeaponDamageType); ExecuteWeaponFunctors(MainHand)"
data "Icon" "Action_SlashingFlourish_Melee"
data "DisplayName" "h19c334a3gd6e6g4317g9f41g4317c9287b4a;1"
data "Description" "h3f394da3g7c25g4a11g8f67gb2628663d15c;1"
data "TooltipDamageList" "DealDamage(MainMeleeWeapon + LevelMapValue(BardicInspiration), MainMeleeWeaponDamageType)"
data "PrepareSound" "Action_Prepare_Bard_Flourish"
data "PrepareLoopSound" "Action_Loop_Bard_Flourish"
data "CastSound" "Action_Cast_Bard_DefensiveFlourishMelee"
data "AlternativeCastTextEvents" ""
data "UseCosts" ""
data "DualWieldingUseCosts" ""
data "SpellAnimation" "a09de2c8-ec46-4c27-a502-bc92cf293fe5,,;9583ecee-cf6c-4735-86db-7ebf1df15eae,366693ee-d97f-4294-a4dd-a2145ddc4e6a,9f2d32b9-529a-4b75-b3df-6e1ae1395280;de006e3f-70fb-4eb7-a98d-d845d15b20e8,479ee5da-2967-41e1-b7d1-a94e864a5f25,79323098-edb3-4993-ba50-9b5f705e9878;50696db7-d931-4734-915d-32d038ba99a5,b5cb923d-0c08-4c20-89a9-44b9bf98c6cb,6282d127-0c06-4365-9d53-6f32ef350127;244b53cb-dc0f-4932-afd0-ab19c6df1b34,,;c36ed247-2272-492b-99c2-2ca10b014670,ecbf9949-3b33-432c-b735-e47aaed0924a,e71a7c08-fdc1-4a0b-9a90-1c793c58553c;0b07883a-08b8-43b6-ac18-84dc9e84ff50,,;,,;,,"
data "VerbalIntent" "Damage"
data "SpellFlags" "IsMelee;IsHarmful"
data "PrepareEffect" "9b55a45f-1859-4f55-8fd4-44a27d3fcba1"
data "CastEffect" "f573afc5-f018-4a87-a3a9-d1c0fe4e5b0d"

new entry "Target_BladeFlourish_Slashing_ExtraAttack_Ranged"
type "SpellData"
data "SpellType" "Projectile"
using "Projectile_MainHandAttack"
data "SpellProperties" "GROUND:DealDamage(MainRangedWeapon, MainRangedWeaponDamageType);GROUND:ExecuteWeaponFunctors(MainHand);RemoveStatus(SELF,FLOURISH_SLASHING_EXTRA_ATTACK_RANGED)"
data "SpellRoll" "Attack(AttackType.RangedWeaponAttack)"
data "SpellSuccess" "DealDamage(max(1,MainRangedWeapon + LevelMapValue(BardicInspiration)), MainRangedWeaponDamageType); ExecuteWeaponFunctors(MainHand)"
data "Trajectories" "4d75cb6e-0fa2-4305-a18c-15876e55e031"
data "Icon" "Action_SlashingFlourish_Ranged"
data "DisplayName" "h50f20933g05dfg4ff6g89f6g0da696b88c5a;1"
data "Description" "h8c38988dg57f7g4a12g9ff6g1b27b8284a3d;1"
data "TooltipDamageList" "DealDamage(MainRangedWeapon + LevelMapValue(BardicInspiration), MainRangedWeaponDamageType)"
data "PrepareSound" "Action_Prepare_Bard_Flourish"
data "PrepareLoopSound" "Action_Loop_Bard_Flourish"
data "CastSound" "Action_Cast_Bard_DefensiveFlourishRanged"
data "UseCosts" ""
data "DualWieldingUseCosts" ""
data "SpellAnimation" "a09de2c8-ec46-4c27-a502-bc92cf293fe5,,;9583ecee-cf6c-4735-86db-7ebf1df15eae,,;de006e3f-70fb-4eb7-a98d-d845d15b20e8,,;50696db7-d931-4734-915d-32d038ba99a5,,;244b53cb-dc0f-4932-afd0-ab19c6df1b34,,;,,;f920a0a6-f257-4ce4-8d17-2dcaa7bb7bbb,,;,,;,,"
data "VerbalIntent" "Damage"
data "SpellFlags" "HasHighGroundRangeExtension;RangeIgnoreVerticalThreshold;IsHarmful"
data "PrepareEffect" "00d37401-b1a7-42eb-ad64-ca4954111a85"
data "CastEffect" "27ae62db-1606-4e42-9bc9-aeb09dcc4f64"

new entry "FLOURISH_MOBILE_PUSH"
type "StatusData"
data "StatusType" "EFFECT"
data "OnApplyFunctors" "Force(6)"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"

new entry "FLOURISH_SLASHING_EXTRA_ATTACK_MELEE"
type "StatusData"
data "StatusType" "EFFECT"
data "Boosts" "UnlockSpell(Target_BladeFlourish_Slashing_ExtraAttack_Melee)"
data "RemoveEvents" "OnSpellCast;OnMove"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"

new entry "FLOURISH_SLASHING_EXTRA_ATTACK_RANGED"
type "StatusData"
data "StatusType" "EFFECT"
data "Boosts" "UnlockSpell(Target_BladeFlourish_Slashing_ExtraAttack_Ranged)"
data "RemoveEvents" "OnSpellCast;OnMove"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
