// ==================================== Highly contested Monk entry compatibility patching - OneDeezNnutsDMartialArts/Druid QoL/Vessel/WayOfTheBoulder/Hexblade ====================================
// TODO: Update loca for this to specify all the functionality.
// TODO: Functions to condense... functionality.

new entry "MartialArts_DextrousUnarmedAttacks"
type "PassiveData"
using "MartialArts_DextrousUnarmedAttacks"
data "BoostConditions" "(IsDexterityGreaterThanStrength() and not Tagged('BOULDER', context.Source) and not Tagged('VESSEL', context.Source) and not HasStatus('ASTRALSELF_EMPOWERED_WISDOM', context.Source) and not (HasStatus('SHILLELAGH', GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand, context.Source)) and ConditionResult(context.Source.Wisdom >= context.Source.Dexterity)) or (HasStatus('PACT_BLADE', GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand, context.Source)) and ConditionResult(context.Source.Charisma >= context.Source.Strength) and ConditionResult(context.Source.Charisma >= context.Source.Dexterity)) or (HasStatus('HEXBLADE_BLADE', GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand, context.Source)) and ConditionResult(context.Source.Charisma >= context.Source.Strength) and ConditionResult(context.Source.Charisma >= context.Source.Dexterity)))"

new entry "CL_Passive_OneDnD_MartialArts_DextrousAttacks"
type "PassiveData"
using "CL_Passive_OneDnD_MartialArts_DextrousAttacks"
data "BoostConditions" "(IsDexterityGreaterThanStrength() and not Tagged('BOULDER', context.Source) and not Tagged('VESSEL', context.Source) and not HasStatus('ASTRALSELF_EMPOWERED_WISDOM', context.Source) and not (HasStatus('SHILLELAGH', GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand, context.Source)) and ConditionResult(context.Source.Wisdom >= context.Source.Dexterity)) or (HasStatus('PACT_BLADE', GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand, context.Source)) and ConditionResult(context.Source.Charisma >= context.Source.Strength) and ConditionResult(context.Source.Charisma >= context.Source.Dexterity)) or (HasStatus('HEXBLADE_BLADE', GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand, context.Source)) and ConditionResult(context.Source.Charisma >= context.Source.Strength) and ConditionResult(context.Source.Charisma >= context.Source.Dexterity)))"

// new entry "CL_Passive_OneDnD_MartialArts_DextrousAttacks"
// type "PassiveData"
// using "CL_Passive_OneDnD_MartialArts_DextrousAttacks"
// data "BoostConditions" "
// (IsDexterityGreaterThanStrength()
//  and not (Tagged('BOULDER', context.Source) or Tagged('VESSEL', context.Source) or HasStatus('ASTRALSELF_EMPOWERED_WISDOM', context.Source)) 
//  and not (HasStatus('SHILLELAGH', GetActiveWeapon()) and ConditionResult(context.Source.Wisdom >= context.Source.Dexterity)) or 

//  (HasAnyStatus({'PACT_BLADE','HEXBLADE_BIND','FLAME_BLADE_MEPHISTOPHELES'},{},{},GetActiveWeapon()) and ConditionResult(context.Source.Charisma >= context.Source.Strength) and ConditionResult(context.Source.Charisma >= context.Source.Dexterity))

// MAG_MELEE_CASTER_BOON

// new entry "MartialArts_DextrousUnarmedAttacks"
// type "PassiveData"
// using "MartialArts_DextrousUnarmedAttacks"
// data "BoostConditions" "IsDexterityGreaterThanStrength() and not HasAnyStatus({'PACT_BLADE','HEXBLADE_BIND','FLAME_BLADE_MEPHISTOPHELES'},{},{},GetActiveWeapon());"

// ==================================== Compatibility patch for Expansion and True Darkness - 5e RAW ====================================
// I don't really understand why Expansion is checking context.Source for things with the Advantage(AttackTarget).
// TODO: Create functions for this stuff in library.
// TODO: Decrease attack roll per 1m for each meter beyond 3. Ranged attacks are too good with TD.

new entry "BLINDED"
type "StatusData"
data "StatusType" "BOOST"
using "BLINDED"
// Blinded
// data "DisplayName" "h61169861gae88g4aadgb0degc3c1cc0e0885;1"
// Has &lt;LSTag Tooltip="Disadvantage"&gt;Disadvantage&lt;/LSTag&gt; on &lt;LSTag Tooltip="AttackRoll"&gt;Attack Rolls&lt;/LSTag&gt;. Range of attacks and spells reduced to [1]. &lt;br&gt;&lt;br&gt;Attack Rolls against Blinded creatures have &lt;LSTag Tooltip="Advantage"&gt;Advantage&lt;/LSTag&gt;.
// data "Description" "h80779d74g9d58g47ebga2a9g171250a92ad6;4"
// data "DescriptionParams" "Distance(3)"
// data "Icon" "Status_Blinded"
// data "StillAnimationType" "Blinded"
// data "StillAnimationPriority" "Blinded"
// data "SoundVocalStart" "WEAK"
// data "SoundLoop" "Spell_Status_Blinded_MO"
// data "SoundStop" "Spell_Status_Blinded_MO_Stop"
// data "StackId" "BLINDED"
// data "Boosts" "Disadvantage(AttackRoll); Advantage(AttackTarget); SightRangeMaximum(3)"
data "Boosts" "IF(not (IsImmuneToStatus('SG_Blinded',context.Source) or (HasPassive('FightingStyle_BlindFighting',context.Source) and not DistanceToGreaterThan(context.SourcePosition, context.TargetPosition, 3))) or (HasPassive('Blindsense',context.Source) and not HasStatus('SG_Deafened',context.Source))):Disadvantage(AttackRoll);IF(not (IsImmuneToStatus('SG_Blinded',context.Target) or (HasPassive('FightingStyle_BlindFighting',context.Target) and not DistanceToGreaterThan(context.SourcePosition, context.TargetPosition, 3))) or (HasPassive('Blindsense',context.Target) and not HasStatus('SG_Deafened',context.Target))):Advantage(AttackTarget)"
// data "StatusPropertyFlags" "InitiateCombat;Blind"
// data "StatusGroups" "SG_Blinded;SG_Condition"
// data "ApplyEffect" "39044361-a2df-4730-90ca-ce37ddcbc482"
// data "StatusEffect" "5c53ef4c-bd94-4567-94c1-8b1a8cefa7e3"

// ==================================== Expansion

// new entry "BLINDED"
// type "StatusData"
// data "StatusType" "BOOST"
// using "BLINDED"
// data "DescriptionParams" "Distance(1.5)"
// data "Boosts" "IF(not (HasPassive('FightingStyle_BlindFighting',context.Source) or (HasPassive('Blindsense',context.Source) and not (HasPassive('Deafness',context.Source) or HasStatus('SG_Deafened',context.Source)))) or DistanceToTargetGreaterThan(3)):Disadvantage(AttackRoll); IF(not (HasPassive('FightingStyle_BlindFighting',context.Target) or (HasPassive('Blindsense',context.Source) and not (HasPassive('Deafness',context.Source) or HasStatus('SG_Deafened',context.Source)))) or DistanceToTargetGreaterThan(3)):Advantage(AttackTarget); SightRangeMaximum(2)"

// ==================================== True Darkness RAW

// new entry "BLINDED"
// type "StatusData"
// data "StatusType" "BOOST"
// using "BLINDED"
// A blinded creature can't see and automatically fails any &lt;LSTag Tooltip="AbilityCheck"&gt;ability check&lt;/LSTag&gt; that requires sight.&lt;br&gt;&lt;Br&gt;&lt;LSTag Tooltip="AttackRoll"&gt;Attack rolls&lt;/LSTag&gt; against the creature have ad&lt;LSTag Tooltip="Advantage"&gt;Advantage&lt;/LSTag&gt;vantage, and the creature's attack rolls have &lt;LSTag Tooltip="Disadvantage"&gt;disadvantage&lt;/LSTag&gt;.
// data "Description" "h5c55526f9fa245028ae5fd714d69378d1aca;1"
// Support for mods that introduce FightingStyle_BlindFighting to work correctly at 10ft distance
// data "Boosts" "IF(not TD_BlindFighting()):Disadvantage(AttackRoll); IF(not TD_BlindFighting(context.Target)):Advantage(AttackTarget)"

// function TD_BlindFighting(entity)
//     entity = entity or context.Source
//     return IsImmuneToStatus('SG_Blinded', entity)
//     | (HasPassive('FightingStyle_BlindFighting', entity) & ~DistanceToGreaterThan(context.SourcePosition, context.TargetPosition, 3))
// end

// ==================================== Blackguard's Darkness tooltip to reflect that of True Darkness - 5e RAW ====================================

new entry "TARGET_INVOKE_DARKNESS"
type "SpellData"
data "SpellType" "Target"
using "TARGET_INVOKE_DARKNESS"
data "Description" "hf645e523dabe4f4582d14d37e5300b4a3522"
